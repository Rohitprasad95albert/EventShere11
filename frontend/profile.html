<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Profile - EventSphere</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>.profile-pic { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; }</style>
</head>
<body>
  <header id="navbar-container"></header>
  <div class="container mt-5">
    <div class="row justify-content-center text-center">
      <div class="col-md-6"><img src="https://via.placeholder.com/150" alt="Profile Picture" class="profile-pic mb-3" id="profile-image-display">
        <h2 id="profile-name">Loading...</h2><p class="text-muted" id="profile-email">...</p></div>
    </div>
    <div class="row justify-content-center mt-4">
      <div class="col-md-6"><h4>Update Profile</h4>
        <form id="profile-update-form">
          <div class="mb-3"><label for="name" class="form-label">Full Name</label><input type="text" class="form-control" id="name"></div>
          <div class="mb-3"><label for="email" class="form-label">Email</label><input type="email" class="form-control" id="email"></div>
          <button type="submit" class="btn btn-primary">Update Details</button>
        </form><hr class="my-4"><h4>Update Profile Picture</h4>
        <form id="profile-image-form">
            <div class="mb-3"><label for="profileImage" class="form-label">Upload New Image</label><input class="form-control" type="file" id="profileImage" accept="image/*"></div>
            <button type="submit" class="btn btn-secondary">Upload Image</button>
        </form>
        <p id="profile-message" class="mt-3 text-success" style="display: none;"></p><p id="profile-error" class="mt-3 text-danger" style="display: none;"></p>
      </div></div></div>
<script src="config.js"></script>
<script>
    const token = localStorage.getItem('token');
    if (!token) window.location.href = "login.html";
    const headers = { 'Authorization': `Bearer ${token}` };
    const nameInput = document.getElementById('name'), emailInput = document.getElementById('email'), profileName = document.getElementById('profile-name'), profileEmail = document.getElementById('profile-email'), profileImageDisplay = document.getElementById('profile-image-display'), msg = document.getElementById('profile-message'), err = document.getElementById('profile-error');
    const userRole = localStorage.getItem('role');
    if (userRole === 'club') document.getElementById('dashboard-link').href = 'club-dashborad.html';
    if (userRole === 'admin') document.getElementById('dashboard-link').href = 'admin-dashborad.html';
    async function loadProfile() { try { const res = await fetch(`${BASE_URL}/api/users/profile`, { headers }); const user = await res.json(); if (!res.ok) throw new Error(user.error); nameInput.value = user.name; emailInput.value = user.email; profileName.innerText = user.name; profileEmail.innerText = user.email; if (user.profileImageUrl) profileImageDisplay.src = `${BASE_URL}${user.profileImageUrl}`; } catch (error) { err.innerText = error.message; err.style.display = 'block'; } }
    document.getElementById('profile-update-form').addEventListener('submit', async (e) => { e.preventDefault(); try { const res = await fetch(`${BASE_URL}/api/users/profile`, { method: 'PATCH', headers: { 'Content-Type': 'application/json', ...headers }, body: JSON.stringify({ name: nameInput.value, email: emailInput.value }) }); const result = await res.json(); if (!res.ok) throw new Error(result.error); msg.innerText = 'Profile details updated!'; msg.style.display = 'block'; loadProfile(); } catch (error) { err.innerText = error.message; err.style.display = 'block'; } });
    document.getElementById('profile-image-form').addEventListener('submit', async (e) => { e.preventDefault(); const fileInput = document.getElementById('profileImage'); if (fileInput.files.length === 0) { err.innerText = 'Please select an image file.'; err.style.display = 'block'; return; } const formData = new FormData(); formData.append('profileImage', fileInput.files[0]); try { const res = await fetch(`${BASE_URL}/api/users/profile/image`, { method: 'POST', headers, body: formData }); const result = await res.json(); if (!res.ok) throw new Error(result.error); msg.innerText = 'Profile image updated!'; msg.style.display = 'block'; profileImageDisplay.src = `${BASE_URL}${result.user.profileImageUrl}`; } catch (error) { err.innerText = error.message; err.style.display = 'block'; } });
    document.addEventListener('DOMContentLoaded', loadProfile);
</script>
<script src="navbar.js"></script>
</body>
</html>